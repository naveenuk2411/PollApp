{"ast":null,"code":"var _jsxFileName = \"/Users/naveen.kumar3/PollReactApp/pollapp/src/pages/PollResultPage.tsx\",\n  _s = $RefreshSig$();\nimport { Stack, Typography } from \"@mui/material\";\nimport React from \"react\";\nimport axios from \"axios\";\nimport { useAuth } from \"../customHooks/useAuth\";\nimport PollResult from \"../components/PollResult\";\nimport { calculateRelativeVotePercentage } from \"../util/RelativeVotePercentage\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst PollResultPage = props => {\n  _s();\n  const [pollOptions, setPollOptions] = React.useState([]);\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [hasError, setHasError] = React.useState(false);\n  const [errorMessage, setErrorMessage] = React.useState(\"\");\n  const [pollVotesMap, setPollVotesMap] = React.useState(new Map());\n  const [totalVotes, setTotalVotes] = React.useState(0);\n  const [pollVotesPercentMap, setPollVotesPercentMap] = React.useState(new Map());\n  const {\n    authToken,\n    user\n  } = useAuth();\n  const fetchPollOptions = async pollId => {\n    const res = await axios.get(`http://localhost:8000/polls/${pollId}/options`, {\n      headers: {\n        Authorization: `Bearer ${authToken}`\n      }\n    });\n    let pollOptionsData = [];\n    pollOptionsData = res.data.pollOptions.map(pollOption => {\n      return {\n        id: pollOption.id,\n        text: pollOption.text\n      };\n    });\n    setPollOptions(pollOptionsData);\n  };\n  const fetchPollVotes = async pollId => {\n    const res = await axios.get(`http://localhost:8000/polls/${pollId}/votes?user_id=${user === null || user === void 0 ? void 0 : user.id}`, {\n      headers: {\n        Authorization: `Bearer ${authToken}`\n      }\n    });\n    let pollVotesMapData = new Map();\n    res.data.pollVotes.forEach(vote => {\n      let prevCount = pollVotesMapData.get(vote.option.id);\n      if (prevCount === undefined) prevCount = 0;\n      pollVotesMapData.set(vote.option.id, prevCount + 1);\n    });\n    let [pollVotesMapPercentData, totalVotes] = calculateRelativeVotePercentage(pollVotesMapData);\n    setPollVotesMap(pollVotesMapData);\n    setTotalVotes(totalVotes);\n    setPollVotesPercentMap(pollVotesMapPercentData);\n  };\n  React.useEffect(() => {\n    setIsLoading(true);\n    setHasError(false);\n    setErrorMessage(\"\");\n    try {\n      fetchPollOptions(props.poll.id);\n      fetchPollVotes(props.poll.id);\n    } catch (error) {\n      console.log(\"Error in fetching polls\", error);\n      setHasError(true);\n      setErrorMessage(error.message);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: isLoading ? /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h2\",\n      children: \"Fetching poll information\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 9\n    }, this) : hasError ? /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h2\",\n      children: \"Something went wrong from our end\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(Stack, {\n        rowGap: 4,\n        children: [/*#__PURE__*/_jsxDEV(Stack, {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h2\",\n            children: props.poll.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            children: props.poll.description\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"subtitle2\",\n            children: [\"Total Votes: \", totalVotes]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 13\n        }, this), pollOptions.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"body1\",\n          children: \"No poll options to show for the poll\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(Stack, {\n          rowGap: 4,\n          children: pollOptions.map(pollOption => /*#__PURE__*/_jsxDEV(PollResult, {\n            pollText: pollOption.text,\n            pollVotes: pollVotesMap.get(pollOption.id) || 0,\n            pollVotePercentage: pollVotesPercentMap.get(pollOption.id) || 0\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 19\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 11\n      }, this)\n    }, void 0, false)\n  }, void 0, false);\n};\n_s(PollResultPage, \"t4E0VvbO4Fy4mD2zkLmNvEGzh1k=\", false, function () {\n  return [useAuth];\n});\n_c = PollResultPage;\nexport default PollResultPage;\nvar _c;\n$RefreshReg$(_c, \"PollResultPage\");","map":{"version":3,"names":["Stack","Typography","React","axios","useAuth","PollResult","calculateRelativeVotePercentage","jsxDEV","_jsxDEV","Fragment","_Fragment","PollResultPage","props","_s","pollOptions","setPollOptions","useState","isLoading","setIsLoading","hasError","setHasError","errorMessage","setErrorMessage","pollVotesMap","setPollVotesMap","Map","totalVotes","setTotalVotes","pollVotesPercentMap","setPollVotesPercentMap","authToken","user","fetchPollOptions","pollId","res","get","headers","Authorization","pollOptionsData","data","map","pollOption","id","text","fetchPollVotes","pollVotesMapData","pollVotes","forEach","vote","prevCount","option","undefined","set","pollVotesMapPercentData","useEffect","poll","error","console","log","message","children","variant","fileName","_jsxFileName","lineNumber","columnNumber","rowGap","title","description","length","pollText","pollVotePercentage","_c","$RefreshReg$"],"sources":["/Users/naveen.kumar3/PollReactApp/pollapp/src/pages/PollResultPage.tsx"],"sourcesContent":["import { FormControlLabel, Radio, Stack, Typography } from \"@mui/material\";\nimport { PollInfo } from \"./PollsPage\";\nimport React from \"react\";\nimport axios from \"axios\";\nimport { POLL_SERVER_POLL_OPTIONS } from \"../constants/Routes\";\nimport { useAuth } from \"../customHooks/useAuth\";\nimport PollResult from \"../components/PollResult\";\nimport { calculateRelativeVotePercentage } from \"../util/RelativeVotePercentage\";\n\ninterface PollResultPageProps {\n  poll: PollInfo;\n}\n\ninterface PollOption {\n  id: number;\n  text: string;\n}\n\nconst PollResultPage = (props: PollResultPageProps): JSX.Element => {\n  const [pollOptions, setPollOptions] = React.useState<PollOption[]>([]);\n  const [isLoading, setIsLoading] = React.useState<boolean>(false);\n  const [hasError, setHasError] = React.useState<boolean>(false);\n  const [errorMessage, setErrorMessage] = React.useState<string>(\"\");\n  const [pollVotesMap, setPollVotesMap] = React.useState<Map<number, number>>(\n    new Map<number, number>()\n  );\n  const [totalVotes, setTotalVotes] = React.useState<number>(0);\n  const [pollVotesPercentMap, setPollVotesPercentMap] = React.useState<\n    Map<number, number>\n  >(new Map<number, number>());\n  const { authToken, user } = useAuth();\n\n  const fetchPollOptions = async (pollId: number) => {\n    const res = await axios.get(\n      `http://localhost:8000/polls/${pollId}/options`,\n      {\n        headers: {\n          Authorization: `Bearer ${authToken}`,\n        },\n      }\n    );\n    let pollOptionsData: PollOption[] = [];\n    pollOptionsData = res.data.pollOptions.map((pollOption: any) => {\n      return {\n        id: pollOption.id,\n        text: pollOption.text,\n      };\n    });\n    setPollOptions(pollOptionsData);\n  };\n\n  const fetchPollVotes = async (pollId: number) => {\n    const res = await axios.get(\n      `http://localhost:8000/polls/${pollId}/votes?user_id=${user?.id}`,\n      {\n        headers: {\n          Authorization: `Bearer ${authToken}`,\n        },\n      }\n    );\n    let pollVotesMapData: Map<number, number> = new Map<number, number>();\n    res.data.pollVotes.forEach((vote: any) => {\n      let prevCount = pollVotesMapData.get(vote.option.id);\n      if (prevCount === undefined) prevCount = 0;\n      pollVotesMapData.set(vote.option.id, prevCount + 1);\n    });\n    let [pollVotesMapPercentData, totalVotes] =\n      calculateRelativeVotePercentage(pollVotesMapData);\n    setPollVotesMap(pollVotesMapData);\n    setTotalVotes(totalVotes);\n    setPollVotesPercentMap(pollVotesMapPercentData);\n  };\n\n  React.useEffect(() => {\n    setIsLoading(true);\n    setHasError(false);\n    setErrorMessage(\"\");\n    try {\n      fetchPollOptions(props.poll.id);\n      fetchPollVotes(props.poll.id);\n    } catch (error) {\n      console.log(\"Error in fetching polls\", error);\n      setHasError(true);\n      setErrorMessage((error as Error).message);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  return (\n    <>\n      {isLoading ? (\n        <Typography variant=\"h2\">Fetching poll information</Typography>\n      ) : hasError ? (\n        <Typography variant=\"h2\">Something went wrong from our end</Typography>\n      ) : (\n        <>\n          <Stack rowGap={4}>\n            <Stack>\n              <Typography variant=\"h2\">{props.poll.title}</Typography>\n              <Typography variant=\"h6\">{props.poll.description}</Typography>\n              <Typography variant=\"subtitle2\">\n                Total Votes: {totalVotes}\n              </Typography>\n            </Stack>\n            {pollOptions.length === 0 ? (\n              <Typography variant=\"body1\">\n                No poll options to show for the poll\n              </Typography>\n            ) : (\n              <Stack rowGap={4}>\n                {pollOptions.map((pollOption: any) => (\n                  <PollResult\n                    pollText={pollOption.text}\n                    pollVotes={pollVotesMap.get(pollOption.id) || 0}\n                    pollVotePercentage={\n                      pollVotesPercentMap.get(pollOption.id) || 0\n                    }\n                  />\n                ))}\n              </Stack>\n            )}\n          </Stack>\n        </>\n      )}\n    </>\n  );\n};\n\nexport default PollResultPage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}